# スレッド機能ガイド

Slack CLIでスレッドに返信する方法を説明します。

## 📌 thread_ts (スレッドID) とは？

Slackのメッセージには、それぞれ固有のタイムスタンプ（`ts`）があります。
スレッドの親メッセージの`ts`を指定することで、そのスレッドに返信できます。

形式: `1234567890.123456`（UnixタイムスタンプのようなID）

---

## 🔍 thread_tsの取得方法

### 方法1: historyコマンドで確認

```bash
python slack_cli.py history C01234ABCDE
```

出力例:
```
[2024-01-15 10:30:45] Alice: 会議の議事録です 💬 3件の返信
  └─ スレッドID: 1705282245.123456
[2024-01-15 10:31:20] Bob: 了解です
```

→ `1705282245.123456` がthread_ts

### 方法2: Slackアプリから取得

1. メッセージを右クリック（または長押し）
2. 「リンクをコピー」を選択
3. URLの末尾に含まれる数字を確認

例: `https://workspace.slack.com/archives/C01234/p1705282245123456`
→ `p1705282245123456` の `p` を除いて、最後から6桁前にピリオドを入れる
→ `1705282245.123456`

または、簡単に：
1. スレッドを開く
2. URLバーのURLをコピー
3. 最後の `p` で始まる部分を変換

---

## 💬 スレッド機能の使い方

### スレッドの内容を表示

```bash
python slack_cli.py thread <channel_id> <thread_ts>
```

例:
```bash
python slack_cli.py thread C01234ABCDE 1705282245.123456
```

出力例:
```
#general のスレッド:
================================================================================
📌 [2024-01-15 10:30:45] Alice: 会議の議事録です
  ↳ [2024-01-15 10:31:20] Bob: 確認しました
  ↳ [2024-01-15 10:32:10] Charlie: ありがとうございます
================================================================================
```

### スレッドに返信

```bash
python slack_cli.py reply <channel_id> <thread_ts> "返信内容"
```

例:
```bash
# Botとして返信
python slack_cli.py reply C01234ABCDE 1705282245.123456 "了解です"

# ユーザーとして返信
python slack_cli.py --user reply C01234ABCDE 1705282245.123456 "了解です"
```

---

## 🎯 チャットモードでスレッドを使う

### 通常モードからスレッドモードに切り替え

```bash
python slack_cli.py chat C01234ABCDE
```

チャット中に:
```
#general> /reply 1705282245.123456
スレッドモードに切り替えます: 1705282245.123456
#general のスレッドでチャット開始
スレッドID: 1705282245.123456
メッセージを入力してください。'/quit'で終了、'/thread'でスレッド表示
--------------------------------------------------------------------------------
📌 [2024-01-15 10:30:45] Alice: 会議の議事録です
  ↳ [2024-01-15 10:31:20] Bob: 確認しました
================================================================================

#general[スレッド]> こちらこそありがとうございます
✓ スレッドに返信しました
```

### スレッドモード内のコマンド

- `/quit` - チャットを終了
- `/thread` - スレッド内容を再表示
- 普通にメッセージを入力 - スレッドに返信

---

## 📊 実用例

### 例1: 議事録に返信

```bash
# 1. 履歴を見てスレッドIDを確認
python slack_cli.py history C01234ABCDE

# 2. スレッドの内容を確認
python slack_cli.py thread C01234ABCDE 1705282245.123456

# 3. 返信
python slack_cli.py --user reply C01234ABCDE 1705282245.123456 "確認しました"
```

### 例2: チャットモードで複数返信

```bash
python slack_cli.py --user chat C01234ABCDE
```

チャット内で:
```
#general> /reply 1705282245.123456
#general[スレッド]> 質問があります
#general[スレッド]> この件について詳しく教えてください
#general[スレッド]> /quit
```

---

## 💡 Tips

### メッセージ履歴からスレッドIDをコピー

履歴表示でスレッドがあるメッセージには `💬` アイコンと「スレッドID」が表示されます:

```
[2024-01-15 10:30:45] Alice: 会議の議事録です 💬 3件の返信
  └─ スレッドID: 1705282245.123456
```

このIDをコピーして使用できます。

### スレッドIDの見分け方

- 形式: `数字.数字`（例: `1705282245.123456`）
- チャンネルID（`C`で始まる）と混同しないように注意
- ピリオドで区切られているのが特徴

---

## ⚠️ よくあるエラー

### `thread_not_found`

**原因:** スレッドIDが間違っているか、存在しないスレッド

**解決方法:**
- `history`コマンドでスレッドIDを確認
- スレッドIDの形式を確認（ピリオドが含まれているか）

### `not_in_channel`

**原因:** Botがチャンネルに参加していない

**解決方法:**
```
/invite @your-bot-name
```

---

これで、スレッドへの返信が自由自在です！🎉
