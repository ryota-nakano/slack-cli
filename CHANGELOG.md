# 変更履歴

## バージョン 2.1.9 (2024-11-13)

### 🐛 バグ修正（入力と削除の両方を修正）

- **screenCursorLineを追加して画面上のカーソル位置を正確に追跡**
- 入力時と削除時の両方で正しく動作するように改善
- 毎回のredraw後にscreenCursorLineを更新して次回の描画に使用

### 📝 改善

- 画面上の実際のカーソル位置を状態として保持
- currentLineIdx（論理的な位置）とscreenCursorLine（物理的な位置）を区別
- より確実で予測可能な動作

---

## バージョン 2.1.8 (2024-11-13)

### 🐛 バグ修正（最終修正）

- **currentLineIdxを使用して正確に第1行まで移動**: previousLineCountではなく現在のカーソル位置を使用
- 入力時に行が増殖する問題を完全に解決
- カーソルが実際にいる行から第1行までの距離を正確に計算

### 📝 改善

- `currentLineIdx`（カーソルが実際にいる行）を基準に移動
- より確実で論理的な実装

---

## バージョン 2.1.7 (2024-11-13)

### 🐛 バグ修正（重要）

- **第1行に移動してから`\r\x1b[J`を実行**: 上の行が残る問題を修正
- `\x1b[J`は現在のカーソル位置から下しかクリアしないことに対応
- 必ず第1行まで移動してからクリア＆再描画を実行

### 📝 改善

- previousLineCount-1行分上に移動してから処理開始
- これで全ての行が確実にクリアされる

---

## バージョン 2.1.6 (2024-11-13)

### 🐛 バグ修正

- **`\r\x1b[J`を使用したシンプルな方式に変更**: カーソル位置から画面末尾までクリア
- 複雑なカーソル位置追跡を完全に排除
- 行頭に移動 + 画面末尾までクリア + 再描画のシンプルなフロー
- 上に増殖する問題を根本解決

### 📝 改善

- 最もシンプルで確実な実装
- `\x1b[J`（カーソルから画面末尾までクリア）を活用
- カーソル位置の保存/復元が不要

---

## バージョン 2.1.5 (2024-11-13)

### 🐛 バグ修正

- **カーソル位置保存/復元方式に変更**: `\x1b[s`と`\x1b[u`を使用
- 初回プロンプト表示時にカーソル位置を保存
- redrawInput()では常に保存した位置から描画開始
- 「現在どこにいるかわからない」問題を根本解決

### 📝 改善

- より確実なカーソル位置管理
- 描画開始位置が常に一定で予測可能
- 古い行が上に残る問題を完全に解決

---

## バージョン 2.1.4 (2024-11-13)

### 🐛 バグ修正

- **複数行入力の表示ロジックを完全にシンプル化**: 1ステップずつ確実に動作する方式に変更
- カーソル移動を1行ずつ（`\x1b[1A`、`\x1b[1B`）実行して確実性を向上
- `\x1b[nG`を使用して列位置を絶対指定（1-indexed）
- redrawInput()内でカーソル位置設定を完結させシンプル化

### 📝 改善

- コードを40%削減（112行→40行の変更）
- より読みやすく保守しやすいロジック
- ステップバイステップの明確な処理フロー

---

## バージョン 2.1.3 (2024-11-13)

### 🐛 バグ修正

- **複数行表示のロジックを完全に書き直し**: ANSIエスケープシーケンスを使用
- redrawInput()とsetCursorPosition()を根本から改善
- readline.moveCursor()の代わりに直接ANSIコードを使用して正確な制御
- 改行削除時の古い行残留問題を完全に解決

### 📝 改善

- より確実な行クリアロジック（`\x1b[2K`で行全体をクリア）
- カーソル移動の精度向上（`\x1b[nA`、`\x1b[nB`、`\x1b[nC`使用）
- 複数行編集時の表示安定性が大幅に向上

---

## バージョン 2.1.2 (2024-11-13)

### 🐛 バグ修正

- **Backspace/Ctrl+Hで改行削除時の表示バグを修正**: 改行を削除しても古い行が残る問題を解決
- 行数が減った場合に余分な行を完全にクリアするように改善
- previousLineCountプロパティを追加して行数を追跡

### 📝 改善

- redrawInput()メソッドの行クリアロジックを改善
- 複数行から単一行に戻る際の表示を最適化

---

## バージョン 2.1.1 (2024-11-13)

### 🐛 バグ修正

- **Ctrl+J改行の重複表示を修正**: 改行時に過去の入力が重複表示される問題を解決
- 複数行入力時の表示ロジックを改善
- カーソル位置の計算を修正

### 📝 改善

- Ctrl+Jでの改行挿入をドキュメントに明記
- 複数行メッセージの表示を最適化

---

## バージョン 2.1.0 (2024-11-13)

### ✨ 新機能

- **メッセージ削除機能**: `/rm <番号>` コマンドでメッセージを削除可能
  - 例: `/rm 5` で5番目のメッセージを削除
  - 自分のメッセージまたは適切な権限があれば削除可能
- **チャット中のヘルプ**: `/help` コマンドで使用可能なコマンド一覧を表示

### 📝 改善

- ヘルプテキストに削除コマンドを追加
- スレッド表示のヒントを更新
- エラーメッセージを改善

---

## バージョン 2.0.0 (2024-11-13)

### 🎉 完全リビルド

クリーンなアーキテクチャと適切なモジュール化を実現するため、ゼロから完全に書き直しました。

### ✨ 新機能

- **モジュラーアーキテクチャ**: api、ui、commands、utilsモジュールに適切に分離
- **クリーンなコードベース**: 明確な責任分離で100%書き直し
- **改善された構造**: 各モジュールが単一の責任を持つ
- **保守性の向上**: 理解しやすく拡張しやすい

### 📦 モジュール構造

```
src/
├── index.js              # エントリーポイント & CLIルーター
├── api/
│   └── slack-client.js   # 全てのSlack API操作
├── commands/
│   ├── channels.js       # チャンネル一覧
│   └── thread.js         # スレッドチャットセッション
├── ui/
│   ├── readline-input.js # メンション補完付きインライン入力
│   ├── editor-input.js   # 外部エディタ統合
│   └── thread-display.js # メッセージの整形と表示
└── utils/
    └── help.js           # ヘルプテキスト
```

### 🗑️ 削除したもの

- **Python実装**: 完全に削除（要望通り）
- **モノリシックコード**: 770行の単一ファイルを8つの焦点を絞ったモジュールに置き換え
- **冗長なドキュメント**: クリーンなREADMEとクイックスタートに統合
- **一時ファイル**: すべてのバックアップとテストファイルをクリーンアップ

### 🔧 技術的改善

- **コードの重複なし**: DRY原則を全体に適用
- **単一責任**: 各モジュールが1つのことをうまく実行
- **テストしやすい**: モジュラー構造により単体テストが簡単
- **明確な依存関係**: 明示的なモジュールのインポートとエクスポート
- **より良いエラー処理**: 集中化されたエラー管理

### 📝 ドキュメント

- **README.md**: 例付きの包括的なガイド
- **QUICKSTART.md**: 3分で始められる
- **インラインコメント**: コード内の明確なJSDocスタイルのコメント

### 🎯 保持された機能

すべてのオリジナル機能を維持：
- ✅ リアルタイム更新付きスレッドチャット
- ✅ @メンション自動補完
- ✅ Readline & Editor入力モード
- ✅ ユーザー情報キャッシング
- ✅ 日本語対応
- ✅ カラーコード化されたターミナルUI
- ✅ キーボードショートカット（Ctrl+E、Ctrl+C）

### 🚀 パフォーマンス

- v1と同じパフォーマンス特性
- 最適化されたモジュール読み込み
- 効率的なユーザーキャッシング

### 💡 移行に関する注意

v1.xからアップグレードする場合：
1. 設定変更は不要
2. 同じ.envファイル形式
3. 同じコマンドと使い方
4. コードを更新して実行するだけ！

---

**注意**: このバージョンはすべてのPython関連のコードと依存関係を削除します。プロジェクトは純粋なNode.js/JavaScriptになりました。
