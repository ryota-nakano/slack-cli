# 🎯 アーキテクチャ概要

## 📊 コード統計

| 指標 | 値 |
|-----|---|
| **総行数** | 935 |
| **モジュール数** | 8 |
| **モジュールあたりの平均行数** | 約117行 |
| **最大のモジュール** | readline-input.js (291行) |
| **最小のモジュール** | channels.js (36行) |

**旧バージョン**: 単一ファイルに770行
**新バージョン**: 8モジュールに935行（より良い構成のため22%増加）

## 🏗️ モジュール詳細

```
slack-cli/
│
├── 📱 src/index.js (56行)
│   └─> エントリーポイント、CLI引数解析、エラー処理
│
├── 🔌 src/api/slack-client.js (170行)
│   └─> キャッシング付きSlack APIラッパー
│       • キャッシュ付きユーザー情報
│       • チャンネル操作
│       • スレッド操作
│       • メッセージ送信
│
├── 📋 src/commands/
│   ├── channels.js (36行)
│   │   └─> 全チャンネル一覧コマンド
│   │
│   └── thread.js (206行)
│       └─> インタラクティブスレッドチャット
│           • セッション管理
│           • リアルタイム更新
│           • メッセージ処理
│
├── 🎨 src/ui/
│   ├── readline-input.js (291行)
│   │   └─> 自動補完付きインライン入力
│   │       • メンション自動補完
│   │       • キーボード処理
│   │       • カーソル管理
│   │
│   ├── editor-input.js (56行)
│   │   └─> 外部エディタ（vim/nano）
│   │       • 一時ファイル管理
│   │       • プロセス起動
│   │
│   └── thread-display.js (68行)
│       └─> メッセージの整形と表示
│           • 完全なスレッドビュー
│           • 新着メッセージ通知
│
└── 🛠️ src/utils/
    └── help.js (42行)
        └─> ヘルプテキスト生成
```

## 🎨 適用された設計原則

### 1. **単一責任の原則（SRP）**
各モジュールには明確な目的が1つ：
- `slack-client.js`: API通信
- `readline-input.js`: ユーザー入力処理
- `thread-display.js`: メッセージ表示

### 2. **関心の分離（SoC）**
明確な分離：
- **APIレイヤー**: Slack通信
- **UIレイヤー**: ユーザーインタラクション
- **コマンドレイヤー**: ビジネスロジック
- **ユーティリティレイヤー**: 横断的関心事

### 3. **DRY（Don't Repeat Yourself）**
- ユーザーキャッシングは1箇所
- 表示ロジックは集中化
- 重複するAPI呼び出しなし

### 4. **モジュール性**
- 各ファイルを独立してテスト可能
- 実装の置き換えが容易
- 明確な依存関係

### 5. **クリーンコード**
- わかりやすい関数名
- JSDocスタイルのコメント
- 一貫したフォーマット
- 最小限のネスト

## 🔄 データフロー

```
ユーザー入力
    ↓
index.js (コマンドをルーティング)
    ↓
commands/*.js (ビジネスロジック)
    ↓
ui/*.js (ユーザーインタラクション) ←→ api/slack-client.js (API呼び出し)
    ↓
ターミナル出力
```

## 🚀 v1.0からの主な改善点

| 側面 | v1.0（旧） | v2.0（新） |
|-----|----------|----------|
| **構造** | モノリシック | モジュラー |
| **ファイル数** | 1つの大きなファイル | 8つの焦点を絞ったモジュール |
| **テスト可能性** | 困難 | 容易 |
| **保守性** | 難しい | シンプル |
| **Pythonコード** | 含まれる | 削除 |
| **ドキュメント** | 散在 | 統合 |
| **コード品質** | 混在した関心事 | 明確な分離 |

## 📚 モジュール依存関係

```
index.js
├─> commands/channels.js
│   └─> api/slack-client.js
│
├─> commands/thread.js
│   ├─> api/slack-client.js
│   ├─> ui/readline-input.js
│   ├─> ui/editor-input.js
│   └─> ui/thread-display.js
│
└─> utils/help.js
```

**循環依存なし！** ✅

## 🎯 将来の拡張ポイント

モジュラーアーキテクチャのおかげで、新機能の追加が簡単です：

### 新しいコマンドの追加
1. `src/commands/new-command.js` を作成
2. `src/index.js` にルートを追加
3. 完了！

### 新しい入力モードの追加
1. `src/ui/new-input.js` を作成
2. `commands/thread.js` で使用
3. 完了！

### 新しいSlack操作の追加
1. `api/slack-client.js` にメソッドを追加
2. 任意のコマンドで使用
3. 完了！

## 🔑 Slack API スコープ

このアプリケーションが必要とするSlack APIスコープ：

### 必須スコープ

| スコープ | 用途 | 影響 |
|---------|------|------|
| `channels:history` | チャンネルメッセージ取得 | なければチャンネル履歴が見れない |
| `channels:read` | チャンネル一覧取得 | なければチャンネル選択不可 |
| `chat:write` | メッセージ送信 | なければ投稿不可 |
| `users:read` | ユーザー情報取得 | なければメンション補完が動作しない |
| `groups:history` | プライベートチャンネル履歴 | なければプライベートチャンネルが使えない |
| `groups:read` | プライベートチャンネル一覧 | なければプライベートチャンネル選択不可 |
| `search:read` | メッセージ検索 | なければ/refreshコマンドが使えない |

### オプションスコープ

| スコープ | 用途 | 影響 |
|---------|------|------|
| `usergroups:read` | グループメンション名取得 | なければ`@<GROUP_ID>`形式で表示される |
| `channels:write` | チャンネル既読マーク | なければ既読マーク機能が動作しない |
| `groups:write` | プライベートチャンネル既読マーク | なければ既読マーク機能が動作しない |

### トークンタイプ

- **User Token** (`xoxp-`): 推奨。自分の名前で投稿できる
- **Bot Token** (`xoxb-`): 可能だがBot名で投稿される

## 📖 ドキュメント構造

```
docs/
├── README.md          → 完全ガイド
├── QUICKSTART.md      → 3分セットアップ
├── CHANGELOG.md       → バージョン履歴
└── ARCHITECTURE.md    → このファイル
```

## 🧪 テスト戦略

各モジュールを独立してテスト可能：

```javascript
// 例: slack-client.jsのテスト
const SlackClient = require('./src/api/slack-client');
const client = new SlackClient(token);
// 各メソッドを独立してテスト
```

## 🎉 まとめ

v2.0リライトで達成したこと：
- ✅ クリーンで保守しやすいアーキテクチャ
- ✅ 明確な関心の分離
- ✅ テストと拡張が容易
- ✅ コードの重複なし
- ✅ 包括的なドキュメント
- ✅ すべての機能を保持
- ✅ 要望通りPythonコードを削除

**コード品質**: 本番環境対応！ 🚀
